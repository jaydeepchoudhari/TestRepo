# Output file path
$outputFile = "result.txt"

# Clear output file if it exists
if (Test-Path $outputFile) {
    Clear-Content $outputFile
}

# Get all .txt files in current directory (except result.txt)
$files = Get-ChildItem -Path . -Filter "*.txt" | Where-Object { $_.Name -ne "result.txt" }

foreach ($file in $files) {

    # Add the filename first
    Add-Content -Path $outputFile -Value $file.Name

    $found = $false

    # Read file line by line
    Get-Content $file | ForEach-Object {
        $line = $_.Trim()

        # Match only exact lines starting with Inserted SUBMISSION_MASTER old_id=
        if ($line -match "^Inserted SUBMISSION_MASTER old_id=") {
            Add-Content -Path $outputFile -Value $line
            $found = $true
        }
    }

    # Add empty line after each file's section
    Add-Content -Path $outputFile -Value ""
}

Write-Host "Extraction complete. Check result.txt"
